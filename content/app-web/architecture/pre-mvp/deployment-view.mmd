flowchart LR
  subgraph client["User Device"]
    ua["Mobile Browser"]
  end
  subgraph cdn["Edge/CDN"]
    vercel["Vercel Edge (static/ISR)"]
  end
  subgraph supa["Supabase Project"]
    edge["Edge Functions\nGET /quiz, POST /quiz, POST /lead"]
    pg["Postgres"]
    store["Storage exports/"]
    auth["Auth (anon vs service role)"]
    cron["Nightly Export (ops-only)"]
  end
  subgraph posthog["PostHog Cloud"]
    cap["/capture"]
  end
  subgraph email["Email Provider"]
    ml["addContact API"]
  end

  ua --> vercel
  vercel --> edge
  edge --> pg
  edge -. service role .- auth
  vercel -. anon jwt .- auth
  edge --> store
  cron --> store
  vercel -. capture whitelist .-> cap
  edge --> ml
