sequenceDiagram
  participant User
  participant FE as Frontend (Next.js)
  participant API as Supabase API
  participant DB as Supabase DB
  participant PH as PostHog
  participant EMAIL as Email Provider

  User->>FE: open quiz
  FE->>PH: capture "quiz_intro_shown"
  User->>FE: press start
  FE->>PH: capture "quiz_start_clicked"

  FE->>API: GET /quiz
  API->>DB: read questions, copy, flags
  DB-->>API: data
  API-->>FE: payload

  User->>FE: answer Q1..Q6 (local state)
  FE->>API: POST /quiz (answers)
  API->>DB: insert session + answers
  DB-->>API: ok

  alt user leaves email
    FE->>API: POST /lead (email)
    API->>DB: insert lead
    API->>EMAIL: add contact
  end

  FE->>PH: capture "quiz_complete"
  User->>FE: click CTA
  FE->>PH: capture "quiz_cta_clicked"


  participant FE as Frontend
  participant API as Edge
  participant DB as Postgres

  FE->>API: GET /quiz
  API->>DB: read flags(version), questions, copy
  API-->>FE: 200 { ..., quiz_version }

  FE->>API: POST /quiz { ..., quiz_version }
  API->>DB: insert QUIZ_SESSIONS.quiz_version = quiz_version

