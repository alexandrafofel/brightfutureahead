
# Terraform AWS Repo Setup – Documentation Summary  
**Total efort: ~5**

## 🔹 Short Description

Am configurat backend-ul Terraform pentru toate cele 4 medii (dev/prod in EU si US), folosind S3 pentru salvarea fisierului `terraform.tfstate` si DynamoDB pentru locking. Scopul: sa centralizam si protejam informatia despre starea infrastructurii in AWS, astfel incat mai multi developeri sa poata lucra in paralel fara conflicte. Pentru fiecare mediu am definit fisierele `backend.tf` (config remote) si `remote_backend_resources.tf` (resurse AWS). Am testat configurarile cu `terraform init` si `terraform apply`, si am curatat erorile legate de spatiu sau configuratii duplicate. Totul a fost facut din AWS CloudShell, cu spatiu limitat, unde am rulat comenzile in folderele `envs/dev`, `envs/prod`, `envs/dev-us` si `envs/prod-us`.

---

## ⚙️ Rezumat tehnic – pași concreți & comenzi

### 🔧 1. Structura repo

```bash
envs/
├── dev/
│   ├── backend.tf
│   └── remote_backend_resources.tf
├── prod/
│   ├── backend.tf
│   └── remote_backend_resources.tf
├── dev-us/
│   ├── backend.tf
│   └── remote_backend_resources.tf
├── prod-us/
│   ├── backend.tf
│   └── remote_backend_resources.tf
```

### 🪣 2. Configurare backend (ex: envs/dev/backend.tf)

```hcl
terraform {
  backend "s3" {
    bucket         = "ait-terraform-state-dev-eu"
    key            = "dev/terraform.tfstate"
    region         = "eu-central-1"
    dynamodb_table = "ait-terraform-lock-dev-eu"
  }
}
```

### 📦 3. Creare resurse (remote_backend_resources.tf)

```hcl
resource "aws_s3_bucket" "ait_tf_state" {
  bucket = "ait-terraform-state-dev-eu"
  versioning { enabled = true }
  server_side_encryption_configuration {
    rule {
      apply_server_side_encryption_by_default {
        sse_algorithm = "AES256"
      }
    }
  }
  tags = {
    Env     = "dev"
    Project = "AIT"
  }
}

resource "aws_dynamodb_table" "ait_tf_lock" {
  name         = "ait-terraform-lock-dev-eu"
  hash_key     = "LockID"
  billing_mode = "PAY_PER_REQUEST"

  attribute {
    name = "LockID"
    type = "S"
  }

  tags = {
    Env     = "dev"
    Project = "AIT"
  }
}
```

### 🧪 4. Comenzi rulate pentru fiecare mediu

```bash
# Init in fiecare folder:
cd envs/dev
terraform init
terraform apply

# Fix spatiu limitat
rm -rf .terraform
rm -rf ~/.terraform.d/plugin-cache

# Fix provider duplicat (eroare):
# - Scoate provider "aws" duplicat din remote_backend_resources.tf
```

### 🧼 5. Good practices

- Verificare dupa fiecare `terraform init` si `terraform apply`
- Denumiri standardizate pentru bucket-uri si tabele
- Izolare pe medii pentru a permite scalare si mentenanta ulterioara
- Documentatie markdown pentru reproducere viitoare

---

✅ Teste rulate: `terraform init`, `terraform apply`  
✅ Branch: `aws-pipeline-mvp`  
✅ Medii acoperite: dev + prod in `eu-central-1` si `us-east-1`  
✅ Executie in: **AWS CloudShell**
